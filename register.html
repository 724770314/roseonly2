<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>注册</title>
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<link rel="stylesheet" type="text/css" href="css/login.css">
</head>
<script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="js/base.js"></script>
<body>
	<!-- 头部 -->
	<div class="header">
		<div class="head">
			<div class="logo_line2"></div>
			<a href="#" class="roseonly-logo" ></a>
			<a href="#" class="larose-logo"></a>
			<div class="logo_line"></div>
			<div class="right">
				<a href="#" class="right-shop"></a>
				<span class="cartNum">(0)</span>
			</div>
		</div>
	</div>
	<div class="logo-c ontainer">
		<a href="index.html" class="logo_nbtn">
			<img title="roseonly官网" alt="roseonly官网" src="img/logo.jpg">
		</a>
	</div>
	<!-- 导航开始 -->
	<div id="topmenus" class="nav-container">
		<div class="nav-bar">
			<ul id="nav" class="cl-effect-1">
				<li style="margin: 0 32px 0 0;">
					<a href="lovegift.html" class="topmenu_1 qxlm">爱礼推荐</a>
				</li>
				<li>
					<a href="lovegift.html" class="topmenu_1">鲜花玫瑰</a>
				</li>
				<li>
					<a href="lovegift.html" class="topmenu_1">永生玫瑰</a>
				</li>
				<li>
					<a href="lovegift.html" class="topmenu_1">玫瑰珠宝</a>
				</li>
				<li>
					<a href="lovegift.html" class="topmenu_1">玫瑰饰品</a>
				</li>
				<li>
					<a href="#" class="topmenu_1">玫瑰香氛</a>
				</li>
				<li>
					<a href="#" class="topmenu_1">高端定制</a>
				</li>
				<li>
					<a href="#" class="topmenu_1">诺誓世界</a>
				</li>
			</ul>
		</div>
		<script type="text/javascript">
			window.onscroll = function(){
				var topnav = document.getElementById('topmenus');
				var scroll = document.body.scrollTop || document.documentElement.scrollTop;
				if(scroll >= 120){
					topnav.style.position = "fixed";
					topnav.style.top = 0;
				}else if(scroll <= 120){
					topnav.style.position = "";
				}
			}
		</script>
	</div>
	<!-- 主要内容 -->
	<div class="login-container">
		<div class="login_bj">
			<div class="zc_cur_bj">
				<a class="qixi_tz" href=""></a>
				<form id="registerForm" action="" method="post">
					<input type="hidden" name="randKey" id="randKey" value="ff8080816123001901612305a7ac0005" />
					<div class="register">
						<div class="register_nav">
							<select id="countryPrefixs" class="register_text indent" style="border: solid 1px #b3b3b3;">
								<option value="61">澳大利亚</option>
								<option value="82">韩国</option>
								<option value="1">加拿大</option>
								<option value="60">马来西亚</option>
								<option value="1">美国</option>
								<option value="81">日本</option>
								<option value="65">新加坡</option>
								<option value="44">英国</option>
								<option value="86" selected="selected">中国</option>
								<option value="853">中国澳门</option>
								<option value="886">中国台湾</option>
								<option value="852">中国香港</option>
							</select>
						</div>
						<div class="register_nav">
							<input type="text" name="username" id="username" class="register_text" placeholder="请输入手机号" maxlength="11" />
							<div id="prefixC" class="register_nav_86">+86</div>
							<div class="reminder validate"></div>
						</div>
						<div id="mailway" class="register_nav">
							<input type="text" name="rand" id="rand_yzm" class="register_yzm" placeholder="图片验证码" maxlength="4" />
							<div class="register_yzming">
								<img src="" alt="" width="100" height="46"/>
							</div>
							<div class="reminder validate"></div>
							<a class="register_yzmnext" href="">换一张</a>
						</div>
						<div class="clear"></div>
						<div id="mobileway" class="register_nav">
							<input type="text" name="smscode" id="smscode" class="register_yzm" placeholder="短信验证码" maxlength="4" />
							<span>
								<div class="sms_button">
									<a id="getSmsCode" class="background2" href="javascript:;">发送验证码</a>
								</div>
							</span>
							<div class="reminder validate"></div>
							<div style="display: none;">
								<p id="getVoiceCode" class="register_yyzm">
									没收到短信验证码？请使用
									<lable>语音验证码</lable>
								</p>
							</div>
						</div>				
						<div class="register_nav" style="margin-bottom: 0;height: 45px;">
							<input type="password" name="password" id="password" class="register_password" placeholder="6-16位数字或字母" />
							<div class="reminder validate"></div>
						</div>
						<div class="register_p">
							<p class="register_yyzh">
								<a href="login.html">已有账号</a>
							</p>
						</div>
						<div class="register_button">
							<a id="registerSubmit" class="background2" href="javascript:;" name="regSubmitBtn">创建账号</a>
						</div>
						<div class="register_bottom">
							roseonly支持门店城市同城速递服务！
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<!--<script type="text/javascript">
		 $.ajax({
                url:"php/usercheck.php",
                method:"get",
                data:{"username":$("#username").val()},
                success:function (data) {
                    if(data=="0"){
                        usernameExists = false;
                    }else{
                        usernameExists = true;
                        $(".validate").css("display":"block");
                    }
                }
            });
	</script>-->
	<!--结束-->
	<div class="footer">
		<div class="four_nav">
			<a class="four_nav_a bg1" href="#">
				<div class="four_nav_div">
					全场包邮
					<span class="f14 f_wg_box">特殊礼品除外</span>
				</div>
			</a>
			<a class="four_nav_a bg2" href="#">
				<div class="four_nav_div">
					同城速递
					<span class="f14 f_wg_box">支持当日送达</span>
				</div>
			</a>
			<a class="four_nav_a bg3" href="#">
				<div class="four_nav_div">
					爱的留言
					<span class="f14 f_wg_box">支持语音与文字，可随时查阅</span>
				</div>
			</a>
			<a class="four_nav_a bg4" href="#">
				<div class="four_nav_div">
					保养物语
					<span class="f14 f_wg_box">悉心保养，恒久保存爱意</span>
				</div>
			</a>
			<div class="clear"></div>
		</div>
		<div class="footer_box">
			<div class="new_l mr50">
				<a href="">
					<img src="img/logo2.png"/>
				</a>
				<div style="position: relative;margin-top: 30px;">
					<a>关注我们</a>
					<a style="position: absolute;left: 80px;top: -2px;">
						<img src="img/wx.png"/>
					</a>
					<a style="position: absolute;left: 125px;top: -4px;">
						<img src="img/wb.png"/>
					</a>
				</div>
			</div>
			<ul>
				<p>新手指南</p>
				<li><a href="">购物流程</a></li>
				<li><a href="">会员尊享</a></li>
				<li><a href="">常见问题</a></li>
				<li><a href="">指圈测量</a></li>
			</ul>
			<ul>
				<p>售后服务</p>
				<li><a href="">退款说明</a></li>
				<li><a href="">保养物语</a></li>
			</ul>
			<ul>
				<p>物流配送</p>
				<li><a href="">配送方式</a></li>
				<li><a href="">配送服务</a></li>
			</ul>
			<ul style="background: none;">
				<p>关于我们</p>
				<li><a href="">品牌介绍</a></li>
				<li><a href="">销售渠道</a></li>
				<li><a href="">联系我们</a></li>
				<li><a href="">加入我们</a></li>
			</ul>
			<div class="new_r">
				<a href="">
					<img src="img/ewm.jpg" style="width: 122px;"/>
				</a>
				<p>微信关注roseonly</p>
			</div>
		</div>
		<div class="foot-nav">
			京ICP备13007738号 京公网安备11010502023922 www.roseonly.com.cn；诺誓（北京）商业股份有限公司
		</div>
	</div>
	<!--客服开始-->
	<div id="zhichiBtnBox">
		<a id="zhichiBtn" href="javascript:;">
			<img src="http://www.roseonly.com.cn/upload/syspic_new/14703636967439422.svg"/>
		</a>
		<div class="mes_content" style="display: none;">
			<div class="mes_icon">
				<div class="tel_sj">
					<img src="img/arr2.png"/>
				</div>
				<div class="tel_icon">
					<p class="tel_txt">联系电话</p>
					<p class="phone">400-1314-520</p>
				</div>
				<div class="tel_line"></div>
				<div class="zxkf_txt">
					<a href="">在线客服</a>
				</div>
			</div>
		</div>
	</div>
	<!--二维码开始-->
	<div id="ewmBox">
		<a id="ewm" href="javascript:;">
			<img src="http://www.roseonly.com.cn/upload/syspic_new/14945591270622918.svg"/>
		</a>
		<div class="ewm_content">
			<img src="img/ewm2.png"/>
		</div>
	</div>
	<script type="text/javascript">
		$("#zhichiBtnBox").hover(function () {
			$(".mes_content").css({
				display: 'block'
			})
		}, function () {
			$(".mes_content").css({
				display: 'none'
			})
		});
		$("#ewmBox").hover(function () {
			$(".ewm_content").css({
				display: 'block'
			})
		}, function () {
			$(".ewm_content").css({
				display: 'none'
			})
		});
	</script>
	<script type="text/javascript">		
		var prefix = '';
		App.util.setCountries("#countryPrefixs");
		
		$("#countryPrefixs").on("change",function(){
			var prefixInput = $(this).val();
			$('#prefixC').text('+'+prefixInput);
			if(prefixInput!='86'){
				prefix = prefixInput;
				$('#getVoiceCode').hide();
			}else{
				prefix = '';
				$('#getVoiceCode').show();
			}
		});
		$(function(){
			
			//验证用户名是否存在
			$('#username').on('blur',function(){
				var ele = $(this);
				var username = ele.val();
				if(prefix=='' && !App.util.checkMobile(username)){
					//提示长度不对
					ele.siblings('.validate').text('请填写正确的手机号').show();
					return;
				}else{
					ele.siblings('.validate').hide();
				}
				$.getJSON("http://orders.roseonly.com.cn/pcEntrance/checkUsername",{prefix:prefix,username:username},function(data){
					if(data.status==0){
						ele.siblings('.validate').text(data.notice).show();
						ele.data('status',0);
					}else{
						ele.siblings('.validate').hide();
						ele.data('status',1);
					}
				});
			});
					        
			$('#rand_yzm').on('blur',function(){
				var ele=$(this),v=ele.val();
				if(v.length!=4){
					ele.siblings('.validate').text('请输入4位图片验证码').show();
					ele.data('status',0);
				}else{
					ele.siblings('.validate').hide();
					ele.data('status',1);
				}
			});
			
			$('#smscode').on('blur',function(){
				var ele=$(this),v=ele.val();
				if(v.length!=4){
					ele.data('status',0);
				}else{
					ele.data('status',1);
				}
			});
			//注册按钮
			   $('.register_yzm').on('keyup', function () {
		                sr_change();
		        });
		
		        $('.register_text').on('keyup', function () {
		
		                sr_change();
		
		         });
		          function sr_change() {
		                if ($('.register_text').val().length > 0 && $('.register_yzm').val().length > 0) {
		                    $("#registerSubmit").css('background', '#414141');
		                    $("#registerSubmit").hover(
		                        function () {
		                            $(this).css('background', '#676767');
		                        },
		                        function () {
		                            $(this).css('background', '#414141');
		                        }
		                    );
		           } else {
		                    $("#registerSubmit").css('background', '#c6c6c6');
		                    $("#registerSubmit").hover(
		                        function () {
		                            $(this).css('background', '#c6c6c6');
		                        },
		                        function () {
		                            $(this).css('background', '#c6c6c6');
		                        })
		
		                }
		            }
			
			//密码长度
			$('#password').on('blur',function(){
				var ele=$(this),v=ele.val();
				if(v.length<6 || v.length>16){
					ele.siblings('.validate').text('密码长度为6~16个字符').show();
					ele.data('status',0);
				}else{
					ele.siblings('.validate').hide();
					ele.data('status',1);
				}
			});
			// 注册
			$('#registerSubmit').click(function(){
				var self   = $(this);
				
				//重复提交
				if(self.hasClass('disabled')){
					return;
				}
				//填入内容判断
				if($('#username').data('status')!=1){
					$('#username').siblings('.validate').text('请填写正确的手机号').show();
					$('#username').focus();
					return;
				}
				if($('#smscode').data('status')!=1){
					$('#smscode').siblings('.validate').text('请输入4位短信验证码').show();
					$('#smscode').focus();
					return;		
				}
				if($('#password').data('status')!=1){
					$('#password').siblings('.validate').text('密码长度为6~16个字符').show();
					$('#password').focus();
					return;
				}
				
				
				var seo_username = $('#username').val();
				
				//99click统计代码 注册完成
				var tprm="user_id="+seo_username;
		   		__ozfac2(tprm,"#regok");
				//99click代码结束
				
				self.text('正在注册...').addClass('disabled');
				//$('#registerForm').attr('action','/pages/Register/reg.htm').submit();
				$.getJSON("http://orders.roseonly.com.cn/pcEntrance/reg",{
					username:$('#username').val(),
					password:$('#password').val(),
					smscode:$('#smscode').val(),
					randKey:$('#randKey').val(),
					prefix:prefix
				},function(data){
					if(data.status==1){
						setTimeout(function(){
							window.location.href = 'http://www.roseonly.com.cn';
						},100);
						
						//品友注册统计
						pyRegisterCvt(seo_username);
						//聚合统计代码 注册完成
						var _mvq = window._mvq || []; 
						window._mvq = _mvq;
						_mvq.push(['$setAccount', 'm-23932-1']);
						_mvq.push(['$setGeneral', 'registered', '', /*用户名*/ '', /*用户id*/ '']);
						_mvq.push(['$logConversion']);
						//聚合统计代码结束
						
						//亿玛统计代码 注册完成
						_adwq.push([ 
							'_setAction','8cy6u6',
							seo_username //请填入注册用户名 或 注册用户ID (注意是字符串类型 )
						]); 
						//亿玛统计代码结束
		
						//window.location.href = 'http://www.roseonly.com.cn';
					}else{
						$('#password').siblings('.validate').text(data.notice).show();
						self.text('创建账号').removeClass('disabled');
					}
				})
		
			});
			
			//发送短信验证码
			$('#getSmsCode').on('click',function(){
				var mobileEle = $('#username'),
					mobileStatus = mobileEle.data('status'),
					mobile = mobileEle.val();
				var randKey = $("#randKey").val();
				var imgcode = $("#rand_yzm").val();
				var ele1 = $(this) ;
				var ele2 = $('#getVoiceCode');
				if(mobileEle.data('status')!=1){
					mobileEle.siblings('.validate').text('请填写正确的手机号').show();
					mobileEle.focus();
					return false;
				}
				var tprm="phoneNo="+mobile;
		   		__ozfac2(tprm,"#regok_pc");
				if(!ele1.hasClass('disabled') && !ele2.hasClass('disabled')){
					if(imgcode.length==4){
						var time_after = 60,
							timer = setInterval(function(){
								if(time_after==0){
									ele1.text('重新获取').removeClass('disabled');
									clearInterval(timer);
									refreshRand();
									return;
								}
								ele1.text(time_after+'s').addClass('disabled');
								time_after--;
							},1000);
						$.getJSON('http://orders.roseonly.com.cn/sms/sendRegCode?mobile='+mobile+'&imgcode='+imgcode+'&randKey='+randKey+'&prefix='+prefix,function(data){
							if(data.status==1){
							}else if(data.status!=0){
								ele1.parent().parent().siblings('.validate').text(data.notice).show();
							}else{
								alert(data.notice);
								clearInterval(timer);
								refreshRand();
								$("#rand_yzm").val('').focus();
							}
						});
					}else{
						$("#rand_yzm").focus();
						ele1.parent().parent().siblings('.validate').text('请输入4位图形验证码').show();
					}
				}else{
					mobileEle.focus();
				}
			});
			//发送语音验证码
			$('#getVoiceCode').on('click',function(){
				if(prefix!=''){
					return;
				}
				var mobileEle = $('#username'),
					mobileStatus = mobileEle.data('status'),
					mobile = mobileEle.val();
				var randKey = $("#randKey").val();
				var imgcode = $("#rand_yzm").val();
				var ele1 = $('#getSmsCode');
				var ele2 = $(this);
				var tprm="phoneNo="+mobile;
		   		__ozfac2(tprm,"#regok_pc");
				if(mobileStatus==1 && !ele2.hasClass('disabled') && !ele1.hasClass('disabled')){
					if(imgcode.length==4){
						var time_after = 60,
						timer1 = setInterval(function(){
							if(time_after==0){
								ele2.text('语音').removeClass('disabled');
								clearInterval(timer1);
								refreshRand();
								return;
							}
							ele2.text(time_after+'s').addClass('disabled');
							time_after--;
						},1000);
						$.getJSON('http://orders.roseonly.com.cn/sms/sendRegVoice?mobile='+mobile+'&imgcode='+imgcode+'&randKey='+randKey,function(data){
							if(data.status==1){
							}else if(data.status!=0){
								ele2.parent().siblings('.validate').text(data.notice).show();
							}else{
								alert(data.notice);
								clearInterval(timer1);
								refreshRand();
								$("#rand_yzm").val('').focus();
							}
						});
					}else{
						$("#rand_yzm").siblings('.validate').text('请输入4位图形验证码').show();
						$("#rand_yzm").focus();
					}
				}else{
					mobileEle.focus();
				}
			});
			
		});

	</script>
</body>
</html>
